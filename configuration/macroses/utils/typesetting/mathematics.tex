\RequirePackage{amsthm}
\makeatletter
    \def\renewtheorem#1{%
    \expandafter\let\csname#1\endcsname\relax
    \expandafter\let\csname c@#1\endcsname\relax
    \gdef\renewtheorem@envname{#1}
    \renewtheorem@secpar
    }
    \def\renewtheorem@secpar{\@ifnextchar[{\renewtheorem@numberedlike}{\renewtheorem@nonumberedlike}}
    \def\renewtheorem@numberedlike[#1]#2{\newtheorem{\renewtheorem@envname}[#1]{#2}}
    \def\renewtheorem@nonumberedlike#1{
    \def\renewtheorem@caption{#1}
    \edef\renewtheorem@nowithin{\noexpand\newtheorem{\renewtheorem@envname}{\renewtheorem@caption}}
    \renewtheorem@thirdpar
    }
    \def\renewtheorem@thirdpar{\@ifnextchar[{\renewtheorem@within}{\renewtheorem@nowithin}}
    \def\renewtheorem@within[#1]{\renewtheorem@nowithin[#1]}
\makeatother


% Convention for theorems.
% {Theorem} --- framed theorem
% {theorem} --- non-framed theorem
% {Theorem*} --- framed theorem without numbering
% {theorem*} --- non-framed theorem without numbering

\RequirePackage{mdframed}
\NewDocumentCommand{\framesetup}{m}{
    \IfNoValueTF{#1}{
        \mdfsetup{innertopmargin=-3pt,linecolor=black,%
              linewidth=1pt,topline=true, frametitleaboveskip=\dimexpr-\ht\strutbox\relax,}
    }{
        \mdfsetup{frametitle={%
            \tikz[baseline=(current bounding box.east),outer sep=0pt]
            \node[anchor=east,rectangle,fill=white]{\strut #1};}}
        \mdfsetup{innertopmargin=-10pt,linecolor=black,%
              linewidth=1pt,topline=true, frametitleaboveskip=\dimexpr-\ht\strutbox\relax,}
    }
}

\NewDocumentCommand{\MakeFramedTheorem}{mm}{
    \NewDocumentEnvironment{#1}{o}
        {\framesetup{##1}\begin{mdframed}\begin{#2}}
        {\end{#2}\end{mdframed}}
}

\ExplSyntaxOn
\tl_new:N\l_env_name_tl
\tl_new:N\l_framed_env_name_tl

\NewDocumentCommand{\NewDocumentTheorem}{md[]md[]}{
  \tl_set:Nn\l_env_name_tl{#1}
  \tl_set:Nx\l_framed_env_name_tl{\str_uppercase:f{\tl_head:N\l_env_name_tl}\tl_tail:N\l_env_name_tl}
  \IfNoValueTF{#2}{
    \IfNoValueTF{#4}{
      \newtheorem{\tl_use:N\l_env_name_tl}{#3}
      \newtheorem*{\tl_use:N\l_env_name_tl*}{#3}
    }{
      \newtheorem{\tl_use:N\l_env_name_tl}{#3}[#4]
      \newtheorem*{\tl_use:N\l_env_name_tl*}{#3}
    }
  }{
    \IfNoValueTF{#4}{
      \newtheorem{\tl_use:N\l_env_name_tl}[#2]{#3}
      \newtheorem*{\tl_use:N\l_env_name_tl*}{#3}
    }{
        \PackageError{layout}{You can not use both counter and other theorem ref in definition}
    }
  }
  \exp_args:Nxx\MakeFramedTheorem{\tl_use:N\l_framed_env_name_tl}{\tl_use:N\l_env_name_tl}
  \exp_args:Nxx\MakeFramedTheorem{\tl_use:N\l_framed_env_name_tl*}{\tl_use:N\l_env_name_tl*}

}
\ExplSyntaxOff

\theoremstyle{plain}
\NewDocumentTheorem{theorem}{Теорема}[subsection]
\NewDocumentTheorem{corollary}[theorem]{Следствие}
\NewDocumentTheorem{lemma}[theorem]{Лемма}
\NewDocumentTheorem{proposition}[theorem]{Предложение}
\NewDocumentTheorem{axiom}{Аксиома}

\theoremstyle{definition}
\NewDocumentTheorem{definition}[theorem]{Определение}
\NewDocumentTheorem{remark}[theorem]{Замечение}


%%%% Strange environments
\theoremstyle{definition}
\newtheorem*{example}{Пример}
\newtheorem*{notation}{Нотация}
